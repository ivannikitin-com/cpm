(function(e){var t={init:function(){e("ul.cpm-todolists").on("click","a.add-task",this.showNewTodoForm);e("ul.cpm-todolists").on("click",".cpm-todos-new a.todo-cancel",this.hideNewTodoForm);e("ul.cpm-todolists").on("submit",".cpm-todo-form form",this.submitNewTodo);e("ul.cpm-todolists").on("click",".cpm-todo-action a.cpm-todo-edit",this.toggleEditTodo);e("ul.cpm-todolists").on("click",".cpm-task-edit-form a.todo-cancel",this.toggleEditTodo);e("ul.cpm-todolists").on("submit",".cpm-task-edit-form form",this.updateTodo);e(".cpm-single-task").on("click",".cpm-todo-action a.cpm-todo-edit",this.toggleEditTodo);e(".cpm-single-task").on("click",".cpm-task-edit-form a.todo-cancel",this.toggleEditTodo);e(".cpm-single-task").on("submit",".cpm-task-edit-form form",this.updateTodo);e(".cpm-single-task").on("click",".cpm-task-uncomplete input[type=checkbox]",this.markDone);e(".cpm-single-task").on("click",".cpm-task-complete input[type=checkbox]",this.markUnDone);e(".cpm-single-task").on("click","a.cpm-todo-delete",this.deleteTodo);e("ul.cpm-todolists").on("click",".cpm-todos input[type=checkbox]",this.markDone);e("ul.cpm-todolists").on("click",".cpm-todo-completed input[type=checkbox]",this.markUnDone);e("ul.cpm-todolists").on("click","a.cpm-todo-delete",this.deleteTodo);e(".cpm-new-todolist-form").on("submit","form",this.addList);e("ul.cpm-todolists").on("submit",".cpm-list-edit-form form",this.updateList);e(".cpm-new-todolist-form").on("click","a.list-cancel",this.toggleNewTaskListForm);e("a#cpm-add-tasklist").on("click",this.toggleNewTaskListFormLink);e("ul.cpm-todolists").on("click","a.cpm-list-delete",this.deleteList);e("ul.cpm-todolists").on("click","a.cpm-list-edit",this.toggleEditList);e("ul.cpm-todolists").on("click","a.list-cancel",this.toggleEditList);this.makeSortableTodoList();this.makeSortableTodo()},makeSortableTodoList:function(){var n=e("ul.cpm-todolists");n&&n.sortable({placeholder:"ui-state-highlight",handle:".move",stop:function(n,r){var i=e(r.item).parents("ul.cpm-todolists").find("> li"),s=[];for(var o=0;o<i.length;o++)s.push(e(i[o]).data("id"));t.saveOrder(s)}})},makeSortableTodo:function(){var n=e("ul.cpm-todos");n&&n.sortable({placeholder:"ui-state-highlight",handle:".move",stop:function(n,r){var i=e(r.item).parents("ul.cpm-todos").find("input[type=checkbox]"),s=[];for(var o=0;o<i.length;o++)s.push(e(i[o]).val());t.saveOrder(s)}})},saveOrder:function(t){var n={items:t,action:"cpm_task_order"};e.post(CPM_Vars.ajaxurl,n)},showNewTodoForm:function(t){t.preventDefault();var n=e(this),r=n.parent().next();n.closest("li").addClass("cpm-hide");r.removeClass("cpm-hide")},hideNewTodoForm:function(t){t.preventDefault();var n=e(this),r=n.closest("li");r.addClass("cpm-hide");r.prev().removeClass("cpm-hide")},markDone:function(){var t=e(this),n=t.closest("li"),r=t.closest("article.cpm-todolist"),i=t.closest(".cpm-single-task"),s={task_id:t.val(),project_id:t.data("project"),list_id:t.data("list"),single:t.data("single"),action:"cpm_task_complete",_wpnonce:CPM_Vars.nonce};e.post(CPM_Vars.ajaxurl,s,function(e){e=JSON.parse(e);if(e.success===!0)if(n.length){var t=n.parent().siblings(".cpm-todo-completed");t.append("<li>"+e.content+"</li>");n.remove();r.find("h3 .cpm-right").html(e.progress)}else i.length&&i.html(e.content)})},markUnDone:function(){var t=e(this),n=t.closest("li"),r=t.closest("article.cpm-todolist"),i=t.closest(".cpm-single-task"),s={task_id:t.val(),project_id:t.data("project"),list_id:t.data("list"),single:t.data("single"),action:"cpm_task_open",_wpnonce:CPM_Vars.nonce};e.post(CPM_Vars.ajaxurl,s,function(e){e=JSON.parse(e);if(e.success===!0)if(n.length){var t=n.parent().siblings(".cpm-todos");t.append("<li>"+e.content+"</li>");n.remove();r.find("h3 .cpm-right").html(e.progress)}else i.length&&i.html(e.content)})},submitNewTodo:function(t){t.preventDefault();var n=e(this),r=n.serialize(),i=n.closest("article.cpm-todolist"),s=e.trim(n.find(".todo_content").val());s!==""?e.post(CPM_Vars.ajaxurl,r,function(e){e=JSON.parse(e);if(e.success===!0){var t=n.closest("ul.cpm-todos-new").siblings(".cpm-todos");t.append("<li>"+e.content+"</li>");n.find("textarea, input[type=text], select").val("");i.find("h3 .cpm-right").html(e.progress)}else alert("something went wrong!")}):alert("type something")},deleteTodo:function(t){t.preventDefault();var n=e(this),r=n.closest("li"),i=n.closest("article.cpm-todolist"),s=n.data("confirm"),o=n.data("single"),u={list_id:n.data("list_id"),project_id:n.data("project_id"),task_id:n.data("task_id"),action:"cpm_task_delete",_wpnonce:CPM_Vars.nonce};confirm(s)&&e.post(CPM_Vars.ajaxurl,u,function(t){t=JSON.parse(t);if(t.success)if(o!=="")location.href=t.list_url;else{r.fadeOut(function(){e(this).remove()});i.find("h3 .cpm-right").html(t.progress)}})},toggleEditTodo:function(t){t.preventDefault();var n=e(this).closest(".cpm-todo-wrap");n.find(".cpm-todo-content").toggle();n.find(".cpm-task-edit-form").slideToggle()},updateTodo:function(t){t.preventDefault();var n=e(this),r=n.serialize(),i=n.closest("li"),s=n.closest(".cpm-single-task"),o=e.trim(n.find(".todo_content").val());o!==""?e.post(CPM_Vars.ajaxurl,r,function(e){e=JSON.parse(e);e.success===!0?i.length?i.html(e.content):s.length&&s.html(e.content):alert("something went wrong!")}):alert("type something")},toggleNewTaskListFormLink:function(t){t.preventDefault();e(".cpm-new-todolist-form").slideToggle()},toggleNewTaskListForm:function(t){t.preventDefault();e(this).closest("form").parent().slideToggle()},toggleEditList:function(t){t.preventDefault();var n=e(this).closest("article.cpm-todolist");n.find("header").slideToggle();n.find(".cpm-list-edit-form").slideToggle()},addList:function(n){n.preventDefault();var r=e(this),i=r.serialize();e.post(CPM_Vars.ajaxurl,i,function(n){n=JSON.parse(n);if(n.success===!0){e("ul.cpm-todolists").append('<li id="cpm-list-'+n.id+'">'+n.content+"</li>");var i=e("#cpm-list-"+n.id);e(".cpm-new-todolist-form").slideToggle();e("body, html").animate({scrollTop:i.offset().top});i.find("a.add-task").click();i.find("textarea.todo_content").focus();r.find("textarea, input[type=text], select").val("");e(".datepicker").datepicker();t.makeSortableTodoList();t.makeSortableTodo()}})},updateList:function(t){t.preventDefault();var n=e(this),r=n.serialize();e.post(CPM_Vars.ajaxurl,r,function(t){t=JSON.parse(t);if(t.success===!0){n.closest("li").html(t.content);e(".datepicker").datepicker()}})},deleteList:function(t){t.preventDefault();var n=e(this),r=n.closest("li"),i=n.data("confirm"),s={list_id:n.data("list_id"),action:"cpm_tasklist_delete",_wpnonce:CPM_Vars.nonce};confirm(i)&&e.post(CPM_Vars.ajaxurl,s,function(t){t=JSON.parse(t);t.success&&r.fadeOut(function(){e(this).remove()})})}};e(function(){t.init()})})(jQuery);